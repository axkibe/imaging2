<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>imaging2: imaging2/fem/equation/DiffusionStep.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_c2b052bc28eb060e42bbb95bc53798eb.html">imaging2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_c51eafc9bc2f2501221bc5cfa9b2e3f1.html">fem</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_a2a85a7f1cd5e6dce2ba4c261aae45c6.html">equation</a>
  </div>
</div>
</div>
<h1>DiffusionStep.hpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// This file is part of the imaging2 class library.</span>
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">// Fuchs Matthias</span>
<a name="l00004"></a>00004 <span class="comment">// University of Innsbruck, Infmath Imaging, 2008.</span>
<a name="l00005"></a>00005 <span class="comment">// http://infmath.uibk.ac.at</span>
<a name="l00006"></a>00006 <span class="comment">//</span>
<a name="l00007"></a>00007 <span class="comment">// All rights reserved.</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="preprocessor">#ifndef EQUATION_DIFFUSIONSTEP_H</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span><span class="preprocessor">#define EQUATION_DIFFUSIONSTEP_H</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;fem/equation/SimpleEquationInterface.hpp&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;boost/shared_ptr.hpp&gt;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="keyword">namespace </span>imaging
<a name="l00018"></a>00018 {
<a name="l00028"></a>00028   <span class="keyword">template</span>&lt;<span class="keyword">class</span> fem_types&gt;
<a name="l00029"></a><a class="code" href="classimaging_1_1DiffusionStep.html">00029</a>   <span class="keyword">class </span><a class="code" href="classimaging_1_1DiffusionStep.html" title="Implements an implicit time step of an isotropic diffusion equation.">DiffusionStep</a> : <span class="keyword">public</span> <a class="code" href="classimaging_1_1SimpleEquationInterface.html" title="Abstract base class of scalar, elliptic PDEs in divergence form.">SimpleEquationInterface</a>&lt;fem_types&gt;
<a name="l00030"></a>00030   {
<a name="l00031"></a>00031     boost::shared_ptr&lt; ublas::vector&lt;float_t&gt; &gt; _input_ptr;
<a name="l00032"></a>00032     boost::shared_ptr&lt; ublas::vector&lt;float_t&gt; &gt; _diffusion_ptr;
<a name="l00033"></a>00033     <a class="code" href="group__core.html#gf2c95632db94ddc193b32e57a1e8e2d9">float_t</a> _step_size;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035   <span class="keyword">public</span>:
<a name="l00036"></a><a class="code" href="classimaging_1_1DiffusionStep.html#d59a4af3badb1ac7a30b35052639a3fe">00036</a>     <span class="keyword">typedef</span> <a class="code" href="classboost_1_1numeric_1_1ublas_1_1fixed__matrix.html" title="uBLAS compatible class template for matrices of fixed size.">ublas::fixed_matrix&lt;float_t, fem_types::data_dimension, fem_types::data_dimension&gt;</a> <a class="code" href="classboost_1_1numeric_1_1ublas_1_1fixed__matrix.html" title="uBLAS compatible class template for matrices of fixed size.">matrix_coefficient_t</a>;
<a name="l00037"></a>00037     <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="classboost_1_1numeric_1_1ublas_1_1fixed__vector.html" title="uBLAS compatible class template for vectors of fixed size.">ublas::fixed_vector&lt;float_t, fem_types::data_dimension&gt;</a> <a class="code" href="classboost_1_1numeric_1_1ublas_1_1fixed__vector.html" title="uBLAS compatible class template for vectors of fixed size.">vector_coefficient_t</a>;
<a name="l00038"></a>00038 
<a name="l00039"></a>00039     <a class="code" href="classimaging_1_1DiffusionStep.html" title="Implements an implicit time step of an isotropic diffusion equation.">DiffusionStep</a>() : _step_size(0.0) {}
<a name="l00040"></a>00040 
<a name="l00042"></a><a class="code" href="classimaging_1_1DiffusionStep.html#1cb10e0a6fd1dd5530d2abfdd2dd1719">00042</a>     <span class="keyword">const</span> ublas::vector&lt;float_t&gt; &amp; <a class="code" href="classimaging_1_1DiffusionStep.html#1cb10e0a6fd1dd5530d2abfdd2dd1719">input</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> *_input_ptr; }
<a name="l00043"></a>00043     
<a name="l00045"></a><a class="code" href="classimaging_1_1DiffusionStep.html#5a0f06673ab958136dc173c02aff0fd7">00045</a>     <span class="keywordtype">void</span> <a class="code" href="classimaging_1_1DiffusionStep.html#5a0f06673ab958136dc173c02aff0fd7">set_input</a>(boost::shared_ptr&lt; ublas::vector&lt;float_t&gt; &gt; input_ptr) { _input_ptr = input_ptr; }
<a name="l00046"></a>00046     
<a name="l00048"></a><a class="code" href="classimaging_1_1DiffusionStep.html#693693c4ebd3c3264b606477297d7cea">00048</a>     <span class="keyword">const</span> ublas::vector&lt;float_t&gt; &amp; <a class="code" href="classimaging_1_1DiffusionStep.html#693693c4ebd3c3264b606477297d7cea">diffusion</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> *_diffusion_ptr; }
<a name="l00049"></a>00049     
<a name="l00051"></a><a class="code" href="classimaging_1_1DiffusionStep.html#f9da991dbce9ea0144ce2a17dc8d6c4f">00051</a>     <span class="keywordtype">void</span> <a class="code" href="classimaging_1_1DiffusionStep.html#f9da991dbce9ea0144ce2a17dc8d6c4f">set_diffusion</a>(boost::shared_ptr&lt; ublas::vector&lt;float_t&gt; &gt; diffusion_ptr) { _diffusion_ptr = diffusion_ptr; }
<a name="l00052"></a>00052     
<a name="l00054"></a><a class="code" href="classimaging_1_1DiffusionStep.html#5ce3bd39e505f3ea0ddcacb23253c8aa">00054</a>     <a class="code" href="group__core.html#gf2c95632db94ddc193b32e57a1e8e2d9">float_t</a> <a class="code" href="classimaging_1_1DiffusionStep.html#5ce3bd39e505f3ea0ddcacb23253c8aa">step_size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _step_size; }
<a name="l00055"></a>00055     
<a name="l00057"></a><a class="code" href="classimaging_1_1DiffusionStep.html#cb97b4d2efa1057e21feb493f01740c3">00057</a>     <span class="keywordtype">void</span> <a class="code" href="classimaging_1_1DiffusionStep.html#cb97b4d2efa1057e21feb493f01740c3">set_step_size</a>(<a class="code" href="group__core.html#gf2c95632db94ddc193b32e57a1e8e2d9">float_t</a> <a class="code" href="classimaging_1_1DiffusionStep.html#5ce3bd39e505f3ea0ddcacb23253c8aa">step_size</a>) { _step_size = step_size; }
<a name="l00058"></a>00058     
<a name="l00059"></a><a class="code" href="classimaging_1_1DiffusionStep.html#4d853fa7c5cadcbe116aeac080dbdac0">00059</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code" href="classimaging_1_1DiffusionStep.html#4d853fa7c5cadcbe116aeac080dbdac0">boundary_data_type</a> = <a class="code" href="classimaging_1_1SimpleEquationInterface.html" title="Abstract base class of scalar, elliptic PDEs in divergence form.">SimpleEquationInterface&lt;fem_types&gt;::NO_BOUNDARY_DATA</a>;
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="classimaging_1_1DiffusionStep.html#ba93c5e8960bf36967241f4b76a06368">00061</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classimaging_1_1DiffusionStep.html#ba93c5e8960bf36967241f4b76a06368">a_active</a> = <span class="keyword">false</span>;
<a name="l00062"></a><a class="code" href="classimaging_1_1DiffusionStep.html#8e128931e08d4e0486b751f8afd4777b">00062</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classimaging_1_1DiffusionStep.html#8e128931e08d4e0486b751f8afd4777b">b_active</a> = <span class="keyword">false</span>;
<a name="l00063"></a><a class="code" href="classimaging_1_1DiffusionStep.html#40e6ec3857a37a029acc972e61d524e0">00063</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classimaging_1_1DiffusionStep.html#40e6ec3857a37a029acc972e61d524e0">c_active</a> = <span class="keyword">true</span>;
<a name="l00064"></a><a class="code" href="classimaging_1_1DiffusionStep.html#9d192abcafa37ddb433dc844df2d5fde">00064</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classimaging_1_1DiffusionStep.html#9d192abcafa37ddb433dc844df2d5fde">f_active</a> = <span class="keyword">true</span>;
<a name="l00065"></a><a class="code" href="classimaging_1_1DiffusionStep.html#5824f0614e5a918bb44b5d45060bfd98">00065</a>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classimaging_1_1DiffusionStep.html#5824f0614e5a918bb44b5d45060bfd98">g_active</a> = <span class="keyword">false</span>;
<a name="l00066"></a>00066     
<a name="l00067"></a><a class="code" href="classimaging_1_1DiffusionStep.html#d084b41bf0666f035dd1ec6240696412">00067</a>     <span class="keywordtype">void</span> <a class="code" href="classimaging_1_1DiffusionStep.html#d084b41bf0666f035dd1ec6240696412">stiffness_matrix</a>(<a class="code" href="group__core.html#g9a15696a1ae77dcbdb1f0de8b115c2e6">std::size_t</a> integrator_node,
<a name="l00068"></a>00068                           <span class="keyword">const</span> <a class="code" href="classimaging_1_1FemKernel.html" title="Computes the values of the shape functions and the element transformation in the...">FemKernel&lt;fem_types&gt;</a> &amp; kernel,
<a name="l00069"></a>00069                           <a class="code" href="classboost_1_1numeric_1_1ublas_1_1fixed__matrix.html" title="uBLAS compatible class template for matrices of fixed size.">matrix_coefficient_t</a> &amp; A,
<a name="l00070"></a>00070                           <a class="code" href="classboost_1_1numeric_1_1ublas_1_1fixed__vector.html" title="uBLAS compatible class template for vectors of fixed size.">ublas::fixed_vector&lt;float_t, fem_types::data_dimension&gt;</a> &amp; a,
<a name="l00071"></a>00071                           <a class="code" href="classboost_1_1numeric_1_1ublas_1_1fixed__vector.html" title="uBLAS compatible class template for vectors of fixed size.">ublas::fixed_vector&lt;float_t, fem_types::data_dimension&gt;</a> &amp; b,
<a name="l00072"></a>00072                           <a class="code" href="group__core.html#gf2c95632db94ddc193b32e57a1e8e2d9">float_t</a> &amp; c)<span class="keyword"> const</span>
<a name="l00073"></a>00073 <span class="keyword">    </span>{ 
<a name="l00074"></a>00074       <a class="code" href="group__core.html#gf2c95632db94ddc193b32e57a1e8e2d9">float_t</a> local_diffusion;
<a name="l00075"></a>00075       kernel.<a class="code" href="classimaging_1_1FemKernel.html#3a0ac5880414db3603a76a358e8d32bd">grid</a>().interpolate_value(integrator_node, *_diffusion_ptr, kernel, local_diffusion);
<a name="l00076"></a>00076       A = _step_size * local_diffusion * ublas::identity_matrix&lt;float_t&gt;(fem_types::data_dimension);
<a name="l00077"></a>00077       c = 1.0;
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079     
<a name="l00080"></a><a class="code" href="classimaging_1_1DiffusionStep.html#e91ce6d65d0d4aee60c47c1acb6d13e2">00080</a>     <span class="keywordtype">void</span> <a class="code" href="classimaging_1_1DiffusionStep.html#e91ce6d65d0d4aee60c47c1acb6d13e2">force_vector</a>(<a class="code" href="group__core.html#g9a15696a1ae77dcbdb1f0de8b115c2e6">std::size_t</a> integrator_node,
<a name="l00081"></a>00081                       <span class="keyword">const</span> <a class="code" href="classimaging_1_1FemKernel.html" title="Computes the values of the shape functions and the element transformation in the...">FemKernel&lt;fem_types&gt;</a> &amp; kernel,
<a name="l00082"></a>00082                       <a class="code" href="group__core.html#gf2c95632db94ddc193b32e57a1e8e2d9">float_t</a> &amp; f,
<a name="l00083"></a>00083                       <a class="code" href="classboost_1_1numeric_1_1ublas_1_1fixed__vector.html" title="uBLAS compatible class template for vectors of fixed size.">ublas::fixed_vector&lt;float_t, fem_types::data_dimension&gt;</a> &amp; g)<span class="keyword"> const</span>
<a name="l00084"></a>00084 <span class="keyword">    </span>{
<a name="l00085"></a>00085       kernel.<a class="code" href="classimaging_1_1FemKernel.html#3a0ac5880414db3603a76a358e8d32bd">grid</a>().interpolate_value(integrator_node, *_input_ptr, kernel, f);
<a name="l00086"></a>00086     }
<a name="l00087"></a>00087     
<a name="l00088"></a><a class="code" href="classimaging_1_1DiffusionStep.html#cdfe0ba85d1d65e4d848515c5fb7ec9d">00088</a>     <span class="keywordtype">bool</span> <a class="code" href="classimaging_1_1DiffusionStep.html#cdfe0ba85d1d65e4d848515c5fb7ec9d">sanity_check_stiffness_matrix</a>(<span class="keyword">const</span> <a class="code" href="classimaging_1_1FemKernel.html" title="Computes the values of the shape functions and the element transformation in the...">FemKernel&lt;fem_types&gt;</a> &amp; kernel, std::string &amp; error_message)<span class="keyword"> const</span>
<a name="l00089"></a>00089 <span class="keyword">    </span>{ 
<a name="l00090"></a>00090       <span class="keywordflow">if</span>(! _diffusion_ptr)
<a name="l00091"></a>00091         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00092"></a>00092         
<a name="l00093"></a>00093       <span class="keywordflow">if</span>(_diffusion_ptr-&gt;size() != kernel.<a class="code" href="classimaging_1_1FemKernel.html#3a0ac5880414db3603a76a358e8d32bd">grid</a>().n_nodes())
<a name="l00094"></a>00094         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00095"></a>00095         
<a name="l00096"></a>00096       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00097"></a>00097     }
<a name="l00098"></a>00098     
<a name="l00099"></a><a class="code" href="classimaging_1_1DiffusionStep.html#56a3a04eebe18607339c595fe4a8db00">00099</a>     <span class="keywordtype">bool</span> <a class="code" href="classimaging_1_1DiffusionStep.html#56a3a04eebe18607339c595fe4a8db00">sanity_check_force_vector</a>(<span class="keyword">const</span> <a class="code" href="classimaging_1_1FemKernel.html" title="Computes the values of the shape functions and the element transformation in the...">FemKernel&lt;fem_types&gt;</a> &amp; kernel, std::string &amp; error_message)<span class="keyword"> const</span>
<a name="l00100"></a>00100 <span class="keyword">    </span>{ 
<a name="l00101"></a>00101       <span class="keywordflow">if</span>(! _input_ptr)
<a name="l00102"></a>00102         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00103"></a>00103         
<a name="l00104"></a>00104       <span class="keywordflow">if</span>(_input_ptr-&gt;size() != kernel.<a class="code" href="classimaging_1_1FemKernel.html#3a0ac5880414db3603a76a358e8d32bd">grid</a>().n_nodes())
<a name="l00105"></a>00105         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00106"></a>00106         
<a name="l00107"></a>00107       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109   };
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Feb 10 10:01:30 2009 for imaging2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
